# Super Client R - åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº”å¤§æ ¸å¿ƒåŠŸèƒ½çš„è®¾è®¡æ–¹æ¡ˆï¼š

1. èŠå¤©é›†æˆ Agent/Skill/MCP è°ƒç”¨
2. MCP å¸‚åœºå’Œç®¡ç†ç³»ç»Ÿ
3. Skill å¸‚åœºå’Œç®¡ç†ç³»ç»Ÿ
4. API Server JWT è®¤è¯
5. æ—¥å¿—ç³»ç»Ÿ

---

## 1. æ—¥å¿—ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

### 1.1 éœ€æ±‚åˆ†æ

- æ”¯æŒå¤šçº§æ—¥å¿—ï¼šinfo/debug/warn/error
- æ—¥å¿—å­˜å‚¨åœ¨ç”¨æˆ·æ•°æ®ç›®å½•
- UTF-8 ç¼–ç å¤„ç†
- æ—¥å¿—è½®è½¬å’Œæ¸…ç†

### 1.2 æ¶æ„è®¾è®¡

```
src/main/utils/logger.ts
â”œâ”€â”€ Logger ç±»
â”‚   â”œâ”€â”€ info(message, meta?)
â”‚   â”œâ”€â”€ debug(message, meta?)
â”‚   â”œâ”€â”€ warn(message, meta?)
â”‚   â””â”€â”€ error(message, error?, meta?)
â”œâ”€â”€ æ—¥å¿—æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶
â”‚   â”œâ”€â”€ è‡ªåŠ¨è½®è½¬ï¼ˆæ¯å¤©ï¼‰
â”‚   â””â”€â”€ è‡ªåŠ¨æ¸…ç†ï¼ˆä¿ç•™7å¤©ï¼‰
â””â”€â”€ UTF-8 ç¼–ç å¤„ç†
    â””â”€â”€ ç»ˆç«¯æ–‡æœ¬ç¼–ç è½¬æ¢
```

### 1.3 æ•°æ®æ¨¡å‹

```typescript
interface LogEntry {
  timestamp: string;      // ISO 8601 æ ¼å¼
  level: 'info' | 'debug' | 'warn' | 'error';
  message: string;
  module?: string;        // æ—¥å¿—æ¥æºæ¨¡å—
  meta?: Record<string, unknown>;
  error?: {
    message: string;
    stack?: string;
  };
}

interface LoggerConfig {
  level: 'debug' | 'info' | 'warn' | 'error';
  logDir: string;         // æ—¥å¿—ç›®å½•
  maxFiles: number;       // ä¿ç•™æ–‡ä»¶æ•°
  maxSize: number;        // å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°
}
```

### 1.4 æ—¥å¿—æ ¼å¼

```
[2024-01-15 10:30:45.123] [INFO] [AgentService] åˆ›å»ºä¼šè¯æˆåŠŸ
[2024-01-15 10:30:45.234] [DEBUG] [McpService] å‘é€è¯·æ±‚: {...}
[2024-01-15 10:30:46.001] [ERROR] [SkillService] æ‰§è¡Œå¤±è´¥
  Error: xxx
  at xxx.ts:123:45
```

---

## 2. èŠå¤©é›†æˆè®¾è®¡æ–¹æ¡ˆ

### 2.1 éœ€æ±‚åˆ†æ

- èŠå¤©ä¸­è°ƒç”¨ Agent è¿›è¡Œå¯¹è¯
- èŠå¤©ä¸­è°ƒç”¨ Skill æ‰§è¡Œå·¥å…·
- èŠå¤©ä¸­è°ƒç”¨ MCP æœåŠ¡å™¨å·¥å…·
- æµå¼å“åº”æ˜¾ç¤º
- å·¥å…·è°ƒç”¨ç»“æœæ¸²æŸ“

### 2.2 æ¶æ„è®¾è®¡

```
Chat Page
â”œâ”€â”€ ChatInput (è¾“å…¥æ¡†)
â”‚   â”œâ”€â”€ æ–‡æœ¬è¾“å…¥
â”‚   â”œâ”€â”€ @ æåŠï¼ˆAgent/Skill/MCPï¼‰
â”‚   â””â”€â”€ å·¥å…·é€‰æ‹©å™¨
â”œâ”€â”€ ChatMessageList (æ¶ˆæ¯åˆ—è¡¨)
â”‚   â”œâ”€â”€ ç”¨æˆ·æ¶ˆæ¯
â”‚   â”œâ”€â”€ AI æ¶ˆæ¯ï¼ˆæµå¼ï¼‰
â”‚   â”œâ”€â”€ å·¥å…·è°ƒç”¨å¡ç‰‡
â”‚   â””â”€â”€ å·¥å…·ç»“æœå¡ç‰‡
â””â”€â”€ ChatStore (çŠ¶æ€ç®¡ç†)
    â”œâ”€â”€ æ¶ˆæ¯å†å²
    â”œâ”€â”€ å½“å‰ä¼šè¯
    â””â”€â”€ æµå¼å†…å®¹
```

### 2.3 æ ¸å¿ƒæµç¨‹

#### Agent è°ƒç”¨æµç¨‹

```
1. ç”¨æˆ·å‘é€æ¶ˆæ¯
2. è°ƒç”¨ agent:send-message IPC
3. AgentService å‘é€åˆ° Claude API
4. æµå¼æ¥æ”¶å“åº”
5. é€å—å‘é€åˆ° Renderer
6. UI å®æ—¶æ˜¾ç¤º
7. å¦‚æœ‰ tool_useï¼Œæ˜¾ç¤ºå·¥å…·è°ƒç”¨å¡ç‰‡
8. æ‰§è¡Œå·¥å…·ï¼Œæ˜¾ç¤ºç»“æœ
9. ç»§ç»­å¯¹è¯
```

#### Skill è°ƒç”¨æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥ @skill-name
2. æˆ–ç‚¹å‡»å·¥å…·æŒ‰é’®é€‰æ‹© Skill
3. è§£æå‚æ•°
4. è°ƒç”¨ skill:execute IPC
5. SkillService æ‰§è¡Œ
6. è¿”å›ç»“æœåˆ°èŠå¤©
```

#### MCP è°ƒç”¨æµç¨‹

```
1. ç”¨æˆ·é€‰æ‹© MCP å·¥å…·
2. è°ƒç”¨ mcp:call-tool IPC
3. McpService å‘é€åˆ° MCP æœåŠ¡å™¨
4. è¿”å›ç»“æœåˆ°èŠå¤©
```

### 2.4 æ•°æ®æ¨¡å‹

```typescript
interface ChatMessage {
  id: string;
  sessionId: string;
  role: 'user' | 'assistant' | 'system' | 'tool';
  content: string;
  timestamp: number;
  type: 'text' | 'tool_use' | 'tool_result' | 'error';
  toolUse?: {
    id: string;
    name: string;
    input: Record<string, unknown>;
    status: 'pending' | 'success' | 'error';
    result?: unknown;
  };
  metadata?: {
    model?: string;
    tokens?: number;
    duration?: number;
  };
}

interface ChatSession {
  id: string;
  name: string;
  type: 'agent' | 'chat';
  agentId?: string;
  createdAt: number;
  updatedAt: number;
  messageCount: number;
}
```

### 2.5 UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Session: General                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·                            â”‚   â”‚
â”‚  â”‚ åˆ†æä¸€ä¸‹ä»Šå¤©çš„å¤©æ°”                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¤– Claude                          â”‚   â”‚
â”‚  â”‚ æˆ‘æ¥ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”...                â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ”§ è°ƒç”¨å·¥å…·: get_weather      â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ å‚æ•°: {"city": "åŒ—äº¬"}        â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ çŠ¶æ€: âœ“ å®Œæˆ                  â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ ç»“æœ: {"temp": 25, ...}       â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ ä»Šå¤©åŒ—äº¬å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©25åº¦...      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [@Agent] [@Skill] [@MCP] [ğŸ¤] [ğŸ“]        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ è¾“å…¥æ¶ˆæ¯...                        â”‚ [â¤]â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. MCP å¸‚åœºå’Œç®¡ç†è®¾è®¡æ–¹æ¡ˆ

### 3.1 éœ€æ±‚åˆ†æ

- MCP å¸‚åœºï¼šæµè§ˆã€æœç´¢ã€å®‰è£…ç¤¾åŒº MCP æœåŠ¡å™¨
- MCP ç®¡ç†ï¼šé…ç½®ã€å¯ç”¨/ç¦ç”¨ã€åˆ é™¤
- MCP çŠ¶æ€ç›‘æ§
- MCP å·¥å…·å‘ç°å’Œè°ƒç”¨

### 3.2 æ¶æ„è®¾è®¡

```
MCP Module
â”œâ”€â”€ MCP Market (å¸‚åœº)
â”‚   â”œâ”€â”€ æœåŠ¡å™¨åˆ—è¡¨
â”‚   â”œâ”€â”€ æœç´¢è¿‡æ»¤
â”‚   â”œâ”€â”€ è¯¦æƒ…å±•ç¤º
â”‚   â””â”€â”€ ä¸€é”®å®‰è£…
â”œâ”€â”€ MCP Manager (ç®¡ç†)
â”‚   â”œâ”€â”€ å·²å®‰è£…åˆ—è¡¨
â”‚   â”œâ”€â”€ é…ç½®ç¼–è¾‘
â”‚   â”œâ”€â”€ å¯åœæ§åˆ¶
â”‚   â””â”€â”€ åˆ é™¤å¸è½½
â”œâ”€â”€ MCP Service (æœåŠ¡)
â”‚   â”œâ”€â”€ è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ å·¥å…·å‘ç°
â”‚   â””â”€â”€ å·¥å…·è°ƒç”¨
â””â”€â”€ MCP Store (çŠ¶æ€)
    â”œâ”€â”€ æœåŠ¡å™¨åˆ—è¡¨
    â”œâ”€â”€ è¿æ¥çŠ¶æ€
    â””â”€â”€ å·¥å…·ç¼“å­˜
```

### 3.3 æ•°æ®æ¨¡å‹

```typescript
// MCP æœåŠ¡å™¨é…ç½®
interface McpServer {
  id: string;
  name: string;
  description: string;
  version: string;
  author: string;

  // å®‰è£…ä¿¡æ¯
  installed: boolean;
  installPath?: string;
  installTime?: number;

  // è¿è¡Œé…ç½®
  config: {
    command: string;
    args: string[];
    env: Record<string, string>;
    workingDir?: string;
  };

  // çŠ¶æ€
  enabled: boolean;
  status: 'disconnected' | 'connecting' | 'connected' | 'error';
  lastError?: string;

  // å·¥å…·
  tools: McpTool[];
}

// MCP å·¥å…·å®šä¹‰
interface McpTool {
  name: string;
  description: string;
  inputSchema: {
    type: 'object';
    properties: Record<string, unknown>;
    required?: string[];
  };
}

// MCP å¸‚åœºæ¡ç›®
interface McpMarketItem {
  id: string;
  name: string;
  description: string;
  version: string;
  author: string;
  tags: string[];
  rating: number;
  downloads: number;
  installUrl: string;
  readmeUrl: string;
}
```

### 3.4 UI è®¾è®¡

#### MCP å¸‚åœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Market                        [ğŸ”]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨] [å®˜æ–¹] [ç¤¾åŒº] [å·²å®‰è£…]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”Œ filesystem                       â”‚   â”‚
â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿæ“ä½œå·¥å…·                    â”‚   â”‚
â”‚  â”‚ â­ 4.5  ğŸ“¥ 10k  ğŸ·ï¸ official        â”‚   â”‚
â”‚  â”‚ [æŸ¥çœ‹è¯¦æƒ…] [å®‰è£…]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ—„ï¸ sqlite                           â”‚   â”‚
â”‚  â”‚ SQLite æ•°æ®åº“æ“ä½œ                   â”‚   â”‚
â”‚  â”‚ â­ 4.2  ğŸ“¥ 5k   ğŸ·ï¸ database        â”‚   â”‚
â”‚  â”‚ [æŸ¥çœ‹è¯¦æƒ…] [å®‰è£…]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MCP ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Manager                       [+ æ·»åŠ ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”Œ filesystem               [å¼€å…³on] â”‚   â”‚
â”‚  â”‚ çŠ¶æ€: ğŸŸ¢ å·²è¿æ¥                     â”‚   â”‚
â”‚  â”‚ å·¥å…·: 5 ä¸ªå¯ç”¨                      â”‚   â”‚
â”‚  â”‚ [é…ç½®] [æŸ¥çœ‹å·¥å…·] [åˆ é™¤]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ—„ï¸ sqlite                   [å¼€å…³off]â”‚   â”‚
â”‚  â”‚ çŠ¶æ€: âšª å·²ç¦ç”¨                     â”‚   â”‚
â”‚  â”‚ [é…ç½®] [æŸ¥çœ‹å·¥å…·] [åˆ é™¤]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Skill å¸‚åœºå’Œç®¡ç†è®¾è®¡æ–¹æ¡ˆ

### 4.1 éœ€æ±‚åˆ†æ

- Skill å¸‚åœºï¼šæµè§ˆã€æœç´¢ã€å®‰è£…ç¤¾åŒº Skill
- Skill ç®¡ç†ï¼šé…ç½®ã€å¯ç”¨/ç¦ç”¨ã€åˆ é™¤
- Skill æ‰§è¡Œç¯å¢ƒ
- Skill æƒé™ç®¡ç†

### 4.2 æ¶æ„è®¾è®¡

```
Skill Module
â”œâ”€â”€ Skill Market (å¸‚åœº)
â”‚   â”œâ”€â”€ Skill åˆ—è¡¨
â”‚   â”œâ”€â”€ æœç´¢è¿‡æ»¤
â”‚   â”œâ”€â”€ è¯¦æƒ…å±•ç¤º
â”‚   â””â”€â”€ ä¸€é”®å®‰è£…
â”œâ”€â”€ Skill Manager (ç®¡ç†)
â”‚   â”œâ”€â”€ å·²å®‰è£…åˆ—è¡¨
â”‚   â”œâ”€â”€ é…ç½®ç¼–è¾‘
â”‚   â”œâ”€â”€ å¯åœæ§åˆ¶
â”‚   â””â”€â”€ åˆ é™¤å¸è½½
â”œâ”€â”€ Skill Service (æœåŠ¡)
â”‚   â”œâ”€â”€ æ‰§è¡Œç¯å¢ƒ
â”‚   â”œâ”€â”€ æƒé™æ§åˆ¶
â”‚   â””â”€â”€ ç»“æœè¿”å›
â””â”€â”€ Skill Store (çŠ¶æ€)
    â”œâ”€â”€ Skill åˆ—è¡¨
    â””â”€â”€ æ‰§è¡ŒçŠ¶æ€
```

### 4.3 æ•°æ®æ¨¡å‹

```typescript
// Skill å®šä¹‰
interface Skill {
  id: string;
  name: string;
  description: string;
  version: string;
  author: string;
  icon?: string;

  // å®‰è£…ä¿¡æ¯
  installed: boolean;
  installPath?: string;
  installTime?: number;

  // é…ç½®
  enabled: boolean;
  config: Record<string, unknown>;

  // æƒé™
  permissions: string[];

  // å·¥å…·å®šä¹‰
  tools: SkillTool[];

  // çŠ¶æ€
  status: 'ready' | 'running' | 'error';
  lastError?: string;
}

// Skill å·¥å…·
interface SkillTool {
  name: string;
  description: string;
  parameters: {
    type: 'object';
    properties: Record<string, {
      type: string;
      description: string;
      required?: boolean;
    }>;
  };
}

// Skill å¸‚åœºæ¡ç›®
interface SkillMarketItem {
  id: string;
  name: string;
  description: string;
  version: string;
  author: string;
  icon?: string;
  tags: string[];
  rating: number;
  downloads: number;
  installUrl: string;
  readmeUrl: string;
  permissions: string[];
}

// Skill æ‰§è¡Œç»“æœ
interface SkillExecutionResult {
  success: boolean;
  output?: unknown;
  error?: string;
  executionTime: number;
  logs?: string[];
}
```

### 4.4 UI è®¾è®¡

#### Skill å¸‚åœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skill Market                      [ğŸ”]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨] [å·¥å…·] [ productivity] [AI]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“Š Data Analyzer                    â”‚   â”‚
â”‚  â”‚ æ•°æ®åˆ†æå’Œå¯è§†åŒ–å·¥å…·                â”‚   â”‚
â”‚  â”‚ â­ 4.8  ğŸ“¥ 20k                      â”‚   â”‚
â”‚  â”‚ æƒé™: æ–‡ä»¶è¯»å–, ç½‘ç»œè¯·æ±‚            â”‚   â”‚
â”‚  â”‚ [æŸ¥çœ‹è¯¦æƒ…] [å®‰è£…]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Skill ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skill Manager                     [+ æ·»åŠ ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“Š Data Analyzer            [å¼€å…³on] â”‚   â”‚
â”‚  â”‚ ç‰ˆæœ¬: 1.2.0                         â”‚   â”‚
â”‚  â”‚ çŠ¶æ€: ğŸŸ¢ å°±ç»ª                       â”‚   â”‚
â”‚  â”‚ å·¥å…·: analyze_csv, visualize        â”‚   â”‚
â”‚  â”‚ [é…ç½®] [æµ‹è¯•] [åˆ é™¤]                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. API Server JWT è®¤è¯è®¾è®¡æ–¹æ¡ˆ

### 5.1 éœ€æ±‚åˆ†æ

- JWT è®¤è¯ä¸­é—´ä»¶
- API Key ç”Ÿæˆå’Œç®¡ç†
- æ¥å£æƒé™æ§åˆ¶
- API æ–‡æ¡£å’Œæµ‹è¯•ç•Œé¢

### 5.2 æ¶æ„è®¾è®¡

```
API Server
â”œâ”€â”€ Auth Middleware
â”‚   â”œâ”€â”€ JWT éªŒè¯
â”‚   â”œâ”€â”€ API Key éªŒè¯
â”‚   â””â”€â”€ æƒé™æ£€æŸ¥
â”œâ”€â”€ API Key Manager
â”‚   â”œâ”€â”€ ç”Ÿæˆ API Key
â”‚   â”œâ”€â”€ æ’¤é”€ API Key
â”‚   â””â”€â”€ æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡
â”œâ”€â”€ Protected Routes
â”‚   â”œâ”€â”€ /api/v1/chat
â”‚   â”œâ”€â”€ /api/v1/agent
â”‚   â”œâ”€â”€ /api/v1/mcp
â”‚   â””â”€â”€ /api/v1/skill
â””â”€â”€ API Docs
    â”œâ”€â”€ Swagger UI
    â””â”€â”€ æµ‹è¯•ç•Œé¢
```

### 5.3 æ•°æ®æ¨¡å‹

```typescript
// API Key
interface ApiKey {
  id: string;
  name: string;
  key: string;              // åŠ å¯†å­˜å‚¨
  prefix: string;           // å‰ç¼€ç”¨äºè¯†åˆ«
  createdAt: number;
  expiresAt?: number;
  lastUsedAt?: number;
  permissions: string[];    // æƒé™åˆ—è¡¨
  enabled: boolean;
  usageCount: number;
  usageLimit?: number;
}

// JWT Payload
interface JwtPayload {
  sub: string;              // API Key ID
  name: string;
  permissions: string[];
  iat: number;
  exp: number;
}

// API æƒé™
enum ApiPermission {
  CHAT_READ = 'chat:read',
  CHAT_WRITE = 'chat:write',
  AGENT_EXECUTE = 'agent:execute',
  MCP_EXECUTE = 'mcp:execute',
  SKILL_EXECUTE = 'skill:execute',
  ADMIN = 'admin',
}
```

### 5.4 API è®¾è®¡

```typescript
// è®¤è¯ç›¸å…³
POST   /api/v1/auth/token     // ä½¿ç”¨ API Key è·å– JWT Token
POST   /api/v1/auth/refresh   // åˆ·æ–° Token

// API Key ç®¡ç† (éœ€è¦ admin æƒé™)
GET    /api/v1/keys           // åˆ—å‡º API Keys
POST   /api/v1/keys           // åˆ›å»º API Key
DELETE /api/v1/keys/:id       // åˆ é™¤ API Key
PATCH  /api/v1/keys/:id       // æ›´æ–° API Key

// ä¸šåŠ¡æ¥å£
POST   /api/v1/chat           // å‘é€æ¶ˆæ¯
GET    /api/v1/chat/history   // è·å–å†å²
POST   /api/v1/agent/execute  // æ‰§è¡Œ Agent
POST   /api/v1/mcp/call       // è°ƒç”¨ MCP å·¥å…·
POST   /api/v1/skill/execute  // æ‰§è¡Œ Skill
```

### 5.5 UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Key Management                [+ åˆ›å»º] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”‘ Production Key                   â”‚   â”‚
â”‚  â”‚ å‰ç¼€: sk_prod_****1234              â”‚   â”‚
â”‚  â”‚ åˆ›å»ºäº: 2024-01-15                  â”‚   â”‚
â”‚  â”‚ æœ€åä½¿ç”¨: 2 åˆ†é’Ÿå‰                  â”‚   â”‚
â”‚  â”‚ ä½¿ç”¨é‡: 1,234 / 10,000              â”‚   â”‚
â”‚  â”‚ æƒé™: chat:write, agent:execute     â”‚   â”‚
â”‚  â”‚ [å¤åˆ¶] [é‡ç½®] [æ’¤é”€]                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. UI ç¾åŒ–è®¾è®¡æ–¹æ¡ˆ

### 6.1 è®¾è®¡åŸåˆ™

- ç°ä»£åŒ–ã€ç®€æ´é£æ ¼
- æµç•…åŠ¨ç”»
- å“åº”å¼å¸ƒå±€
- æ·±è‰²/æµ…è‰²ä¸»é¢˜
- ä¸€è‡´çš„è§†è§‰è¯­è¨€

### 6.2 è‰²å½©ç³»ç»Ÿ

```css
:root {
  /* Primary */
  --color-primary: #1890ff;
  --color-primary-hover: #40a9ff;
  --color-primary-active: #096dd9;

  /* Semantic */
  --color-success: #52c41a;
  --color-warning: #faad14;
  --color-error: #f5222d;
  --color-info: #1890ff;

  /* Neutral (Light) */
  --color-bg: #ffffff;
  --color-bg-secondary: #f5f5f5;
  --color-text: #262626;
  --color-text-secondary: #595959;
  --color-border: #d9d9d9;

  /* Neutral (Dark) */
  --color-bg-dark: #141414;
  --color-bg-secondary-dark: #1f1f1f;
  --color-text-dark: #ffffff;
  --color-text-secondary-dark: #a6a6a6;
  --color-border-dark: #434343;
}
```

### 6.3 åŠ¨ç”»æ•ˆæœ

```typescript
// é¡µé¢è¿‡æ¸¡
const pageTransition = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 },
  transition: { duration: 0.3, ease: 'easeOut' }
};

// æ¶ˆæ¯è¿›å…¥
const messageTransition = {
  initial: { opacity: 0, x: -20 },
  animate: { opacity: 1, x: 0 },
  transition: { duration: 0.3 }
};

// å·¥å…·å¡ç‰‡å±•å¼€
const toolCardTransition = {
  initial: { height: 0, opacity: 0 },
  animate: { height: 'auto', opacity: 1 },
  transition: { duration: 0.2 }
};
```

### 6.4 ç»„ä»¶æ ·å¼

#### èŠå¤©æ¶ˆæ¯æ°”æ³¡

```css
.message-bubble {
  padding: 12px 16px;
  border-radius: 12px;
  max-width: 80%;
  word-wrap: break-word;
}

.message-bubble.user {
  background: var(--color-primary);
  color: white;
  border-bottom-right-radius: 4px;
  margin-left: auto;
}

.message-bubble.assistant {
  background: var(--color-bg-secondary);
  color: var(--color-text);
  border-bottom-left-radius: 4px;
}
```

#### å·¥å…·è°ƒç”¨å¡ç‰‡

```css
.tool-card {
  border: 1px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  margin: 8px 0;
}

.tool-card-header {
  padding: 12px 16px;
  background: var(--color-bg-secondary);
  display: flex;
  align-items: center;
  gap: 8px;
}

.tool-card-body {
  padding: 16px;
}

.tool-status {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.tool-status.success {
  background: rgba(82, 196, 26, 0.1);
  color: var(--color-success);
}
```

---

## 7. å®ç°é¡ºåº

### é˜¶æ®µ 1ï¼šåŸºç¡€ï¼ˆç¬¬ 1-2 å¤©ï¼‰

1. æ—¥å¿—ç³»ç»Ÿå®ç°
2. åŸºç¡€ UI ç»„ä»¶ä¼˜åŒ–

### é˜¶æ®µ 2ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬ 3-5 å¤©ï¼‰

1. èŠå¤©é›†æˆ Agent/Skill/MCP
2. MCP å¸‚åœºå’Œç®¡ç†
3. Skill å¸‚åœºå’Œç®¡ç†

### é˜¶æ®µ 3ï¼šé«˜çº§åŠŸèƒ½ï¼ˆç¬¬ 6-7 å¤©ï¼‰

1. API Server JWT è®¤è¯
2. UI å…¨é¢ç¾åŒ–

### é˜¶æ®µ 4ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆç¬¬ 8-10 å¤©ï¼‰

1. è‡ªåŠ¨åŒ–æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. Bug ä¿®å¤

---

## 8. æŠ€æœ¯è¦ç‚¹

### 8.1 æ—¥å¿—ç³»ç»Ÿ

- ä½¿ç”¨ `winston` æˆ–è‡ªå»ºæ—¥å¿—ç³»ç»Ÿ
- ä½¿ç”¨ `iconv-lite` å¤„ç†ç¼–ç è½¬æ¢
- æ—¥å¿—æ–‡ä»¶ä½¿ç”¨ `.log` åç¼€
- å®ç°æ—¥å¿—æ¸…ç†å®šæ—¶ä»»åŠ¡

### 8.2 èŠå¤©é›†æˆ

- ä½¿ç”¨ `@anthropic-ai/sdk` çš„ streaming API
- ä½¿ç”¨ Ant Design X çš„ Bubble ç»„ä»¶
- å®ç° Markdown æ¸²æŸ“
- ä»£ç é«˜äº®ä½¿ç”¨ `react-syntax-highlighter`

### 8.3 MCP/Skill

- MCP ä½¿ç”¨ `@modelcontextprotocol/sdk`
- Skill ä½¿ç”¨æ²™ç®±æ‰§è¡Œï¼ˆvm2 æˆ– quickjsï¼‰
- æƒé™æ§åˆ¶ä½¿ç”¨å£°æ˜å¼æƒé™åˆ—è¡¨

### 8.4 API Server

- ä½¿ç”¨ `koa-jwt` è¿›è¡Œ JWT éªŒè¯
- API Key ä½¿ç”¨ `crypto.randomBytes` ç”Ÿæˆ
- ä½¿ç”¨ `koa-swagger` ç”Ÿæˆæ–‡æ¡£

### 8.5 UI

- ä½¿ç”¨ `framer-motion` å®ç°åŠ¨ç”»
- ä½¿ç”¨ Ant Design çš„ä¸»é¢˜ç³»ç»Ÿ
- è‡ªå®šä¹‰ CSS å˜é‡æ”¯æŒä¸»é¢˜åˆ‡æ¢
