# 插件系统

Super Client R 提供完整的插件系统，支持通过插件扩展应用功能。插件可以注册命令、介入 AI 聊天流程、提供 MCP 工具、创建 Skill、贡献 UI 组件和自定义主题。

## 插件市场

### 浏览插件

进入 **插件** 页面即可浏览可用的插件列表，每个插件展示：

- 插件名称和图标
- 简短描述
- 作者信息
- 版本号
- 分类标签

### 安装插件

1. 在插件市场中找到目标插件
2. 点击 **安装** 按钮
3. 如果插件声明了权限，系统会弹窗展示所需权限列表，确认后继续
4. 等待安装完成（含依赖安装）
5. 插件自动进入已安装状态

### 本地安装

点击"安装本地插件"按钮，选择包含 `package.json` 的插件目录即可安装。

## 插件管理

### 插件状态

| 状态 | 说明 |
|------|------|
| installing | 正在安装（含依赖安装） |
| installed | 已安装（未激活） |
| activating | 正在激活 |
| active | 已激活（运行中） |
| deactivating | 正在停用 |
| inactive | 已停用 |
| error | 出错 |
| uninstalling | 正在卸载 |

### 启用/停用

- 点击插件的 **启用** 按钮激活插件
- 点击 **停用** 按钮关闭插件功能
- 停用后插件仍然保留在本地，可以随时重新启用
- 停用时系统自动清理该插件注册的所有资源（命令、钩子、工具、UI 组件等）

### 卸载

点击 **卸载** 按钮可以完全移除插件，同时撤销其所有权限。

## 权限系统

插件采用声明式权限模型。第三方插件在安装时需要用户确认所请求的权限，内置插件自动授权。

### 权限类型

| 权限 | 说明 |
|------|------|
| 文件读写 | 访问插件目录内/外的文件 |
| 网络请求 | 发送 HTTP 请求 |
| 窗口交互 | 显示对话框、输入框 |
| 存储 | 持久化存储数据 |
| 命令 | 注册和执行命令 |
| 事件 | 订阅应用事件 |
| 聊天钩子 | 介入 AI 聊天流程 |
| MCP 工具 | 注册 AI 可调用的工具 |
| Skill 创建 | 创建技能模块 |
| UI 扩展 | 侧边栏菜单项、设置面板、自定义页面 |

## 插件功能

插件可以贡献以下扩展点：

### 命令 (Commands)

插件可以注册自定义命令，通过命令面板或快捷键触发执行。

### 聊天钩子 (Chat Hooks)

插件可以介入 AI 聊天的完整管道：

- **发送前** — 修改或拦截用户消息
- **系统提示词** — 注入或修改 system prompt
- **流式响应** — 实时过滤响应内容
- **响应完成** — 后处理最终回复

### MCP 工具 (MCP Tools)

插件可以动态注册 MCP 工具，让 AI 在聊天中自动调用。例如：网页获取、数据查询、外部 API 调用等。

### Skill (技能)

插件可以创建完整的 Skill 模块，包含专属的系统提示词和工具集。

### UI 扩展

- **侧边栏** — 在侧边栏添加自定义菜单项
- **设置面板** — 在设置页面添加插件专属配置项（自动生成表单）
- **自定义页面** — 注册独立的插件页面（在沙箱化 iframe 中渲染）

### 主题 (Themes)

插件可以提供自定义主题，包括 Ant Design Token 配置和 Markdown 渲染样式。

### 快捷键 (Keybindings)

插件可以注册平台相关的快捷键绑定，支持 Mac 和 Windows 不同配置。

### 配置项 (Configuration)

插件可以声明配置属性，系统自动生成设置表单，用户可在设置页面中调整。

## 内置插件

### Prompt Templates

内置的 Prompt Templates 插件提供 AI 提示词模板，帮助用户快速生成高质量的 AI 交互提示。

## 开发者模式

插件系统支持开发者模式：

- **开发模式安装** — 使用符号链接（symlink），修改源代码即时生效
- **热重载** — 一键重载插件，无需重启应用
- **日志过滤** — 在日志查看器中按插件名过滤日志

## 插件更新

系统支持检查插件更新：
- 内置插件：与应用版本对比
- 第三方插件：检查远程仓库版本

## 开发指南

如果你想开发自己的插件，请参阅 [插件开发指南](/PLUGIN_DEVELOPMENT)，了解：

- 插件目录结构和清单配置
- 权限系统和声明方式
- 完整 PluginAPI 参考（12 个命名空间）
- 聊天钩子管道详解
- MCP 工具和 Skill 注册
- UI 扩展（侧边栏、设置面板、自定义页面）
- 开发者模式和调试技巧
- 完整示例插件代码
